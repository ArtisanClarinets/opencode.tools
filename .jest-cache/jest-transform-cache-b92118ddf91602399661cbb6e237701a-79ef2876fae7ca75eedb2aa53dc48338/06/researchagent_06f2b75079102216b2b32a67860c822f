b98e6284179e127cb639bfd98a73691e
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ResearchAgent = void 0;
const webfetch_1 = require("../../tools/webfetch");
const logger_1 = require("../../src/runtime/logger");
const json_db_1 = require("../../src/database/json-db");
const gatekeeper_1 = require("../../src/governance/gatekeeper");
const uuid_1 = require("uuid");
class ResearchAgent {
    constructor(db, gatekeeper) {
        this.agentName = 'research-agent';
        this.promptVersion = 'v1';
        this.mcpVersion = 'v1';
        this.db = db || new json_db_1.JsonDatabase();
        this.gatekeeper = gatekeeper || new gatekeeper_1.ResearchGatekeeper();
    }
    async execute(input) {
        const runId = this.generateRunId();
        const timestamp = new Date().toISOString();
        logger_1.logger.info('Research Agent started', { runId, company: input.brief.company });
        // Initialize Research Record in Database
        const recordId = (0, uuid_1.v4)();
        await this.db.saveResearch({
            id: recordId,
            topic: input.brief.company,
            status: 'in_progress',
            startedAt: timestamp,
            findings: []
        });
        let iterations = 0;
        const maxIterations = 3;
        let companyData = [];
        let industryData = [];
        let competitorData = [];
        let techStackData = { frontend: [], backend: [], infrastructure: [], thirdParty: [] };
        let sources = [];
        // Research Loop
        let gatePassed = false;
        while (iterations < maxIterations) {
            iterations++;
            logger_1.logger.info(`Research iteration ${iterations}/${maxIterations}`);
            // Refine queries based on iteration
            const iterationSuffix = iterations > 1 ? ` depth ${iterations}` : '';
            // Gather research data
            const [newCompanyData, newIndustryData, newCompetitorData, newTechStackData] = await Promise.all([
                this.gatherCompanyData(input, iterationSuffix),
                this.gatherIndustryData(input, iterationSuffix),
                this.gatherCompetitorData(input, iterationSuffix),
                this.gatherTechStackData(input, iterationSuffix)
            ]);
            companyData = [...companyData, ...newCompanyData];
            industryData = [...industryData, ...newIndustryData];
            // Competitors and tech stack might duplicate, but extractors handle some logic.
            // For simplicity in this loop, we just take the latest or merge unique.
            competitorData = newCompetitorData.length > 0 ? newCompetitorData : competitorData;
            techStackData = (newTechStackData.frontend && newTechStackData.frontend.length > 0) ? newTechStackData : techStackData;
            // Compile sources for gatekeeper
            sources = await this.compileSources(companyData, industryData, competitorData);
            // Check Gatekeeper
            const gateResult = this.gatekeeper.evaluate(sources);
            if (gateResult.passed) {
                logger_1.logger.info('Gatekeeper passed', { iterations, score: gateResult.score });
                gatePassed = true;
                break;
            }
            else {
                logger_1.logger.info('Gatekeeper failed, continuing research', { iterations, reasons: gateResult.reasons });
            }
        }
        // Save Findings to DB
        const currentRecord = await this.db.getResearch(recordId);
        if (currentRecord) {
            currentRecord.findings = sources.map(s => ({
                id: (0, uuid_1.v4)(),
                sourceUrl: s.url,
                content: s.title,
                timestamp: s.accessedAt,
                relevanceScore: 1
            }));
            if (gatePassed) {
                currentRecord.status = 'completed';
                currentRecord.completedAt = new Date().toISOString();
            }
            else {
                currentRecord.status = 'in_progress'; // Or 'failed' if strict
                // We keep it in_progress or maybe add a 'review_needed' status?
                // Keeping in_progress implies it's not done.
            }
            await this.db.saveResearch(currentRecord);
        }
        // Generate summaries and analysis
        const companySummary = this.generateCompanySummary(companyData, input);
        const industryOverview = this.generateIndustryOverview(industryData);
        const risks = this.identifyRisks(input, industryData);
        const opportunities = this.identifyOpportunities(input, industryData);
        // Compile dossier
        const dossier = {
            companySummary: companySummary,
            industryOverview: industryOverview,
            competitors: competitorData,
            techStack: techStackData,
            risks: risks,
            opportunities: opportunities,
            recommendations: [
                'Address identified risks through mitigation strategies',
                'Leverage identified opportunities for competitive advantage'
            ]
        };
        logger_1.logger.info('Research Agent completed', { runId, sourcesCount: sources.length });
        return {
            dossier,
            sources,
            meta: {
                agent: this.agentName,
                promptVersion: this.promptVersion,
                mcpVersion: this.mcpVersion,
                timestamp,
                runId
            }
        };
    }
    generateRunId() {
        return `research-${Date.now()}-${Math.random().toString(36).substring(2, 11)}`;
    }
    async gatherCompanyData(input, suffix = '') {
        // Search for company information
        const searchQueries = [
            `${input.brief.company} company overview${suffix}`,
            `${input.brief.company} about us${suffix}`,
            `${input.brief.company} mission vision${suffix}`
        ];
        const results = await Promise.all(searchQueries.map(query => this.searchWeb(query)));
        return results.flat();
    }
    async gatherIndustryData(input, suffix = '') {
        const industryQueries = [
            `${input.brief.industry} industry trends 2024${suffix}`,
            `${input.brief.industry} market analysis${suffix}`,
            `${input.brief.industry} technology adoption${suffix}`
        ];
        const results = await Promise.all(industryQueries.map(query => this.searchWeb(query)));
        return results.flat();
    }
    async gatherCompetitorData(input, suffix = '') {
        const competitorQueries = [
            `${input.brief.industry} top competitors${suffix}`,
            `${input.brief.company} competitors${suffix}`,
            `${input.brief.industry} market leaders${suffix}`
        ];
        const results = await Promise.all(competitorQueries.map(query => this.searchWeb(query)));
        return this.extractCompetitors(results.flat(), input);
    }
    async gatherTechStackData(input, suffix = '') {
        const techQueries = [
            `${input.brief.company} tech stack${suffix}`,
            `${input.brief.company} technology${suffix}`,
            `${input.brief.industry} common tech stack${suffix}`
        ];
        const results = await Promise.all(techQueries.map(query => this.searchWeb(query)));
        return this.extractTechStack(results.flat());
    }
    async searchWeb(query) {
        try {
            // Use webfetch tool to search via DuckDuckGo HTML (more reliable for scraping)
            const result = await (0, webfetch_1.webfetch)(`https://html.duckduckgo.com/html/?q=${encodeURIComponent(query)}`, 'text');
            return [{
                    query,
                    content: result.content,
                    url: result.url,
                    timestamp: new Date().toISOString()
                }];
        }
        catch (error) {
            logger_1.logger.warn(`Search failed for query: ${query}`, { error, query });
            return [];
        }
    }
    extractCompetitors(data, input) {
        // Extract competitor information from search results
        const competitors = [];
        const seen = new Set();
        for (const result of data) {
            // Simple extraction logic - in production, use more sophisticated NLP
            const lines = result.content.split('\n');
            for (const line of lines) {
                if (line.toLowerCase().includes('competitor') ||
                    line.toLowerCase().includes('competition') ||
                    line.toLowerCase().includes('alternative')) {
                    // Extract company names (simple heuristic)
                    const words = line.split(' ');
                    for (let i = 0; i < words.length - 1; i++) {
                        const potentialCompany = words[i] + ' ' + words[i + 1];
                        if (potentialCompany.length > 3 &&
                            !potentialCompany.toLowerCase().includes(input.brief.company.toLowerCase()) &&
                            !seen.has(potentialCompany)) {
                            competitors.push({
                                name: potentialCompany,
                                url: result.url,
                                differentiation: 'Market competitor',
                                marketPosition: 'Established player'
                            });
                            seen.add(potentialCompany);
                            if (competitors.length >= 5)
                                break;
                        }
                    }
                }
                if (competitors.length >= 5)
                    break;
            }
            if (competitors.length >= 5)
                break;
        }
        return competitors.slice(0, 5);
    }
    extractTechStack(data) {
        const techStack = {
            frontend: [],
            backend: [],
            infrastructure: [],
            thirdParty: []
        };
        const commonTech = {
            frontend: ['React', 'Vue', 'Angular', 'Next.js', 'Svelte'],
            backend: ['Node.js', 'Python', 'Java', 'Go', 'Ruby', 'PHP'],
            infrastructure: ['AWS', 'Azure', 'Google Cloud', 'Docker', 'Kubernetes'],
            thirdParty: ['Stripe', 'Twilio', 'SendGrid', 'Auth0', 'Firebase']
        };
        const content = data.map(d => d.content).join(' ').toLowerCase();
        // Extract technologies
        for (const [category, techs] of Object.entries(commonTech)) {
            for (const tech of techs) {
                if (content.includes(tech.toLowerCase())) {
                    const categoryKey = category;
                    if (techStack[categoryKey]) {
                        techStack[categoryKey].push(tech);
                    }
                }
            }
        }
        return techStack;
    }
    generateCompanySummary(companyData, input) {
        // Generate a 3-5 sentence summary
        const baseSummary = `${input.brief.company} operates in the ${input.brief.industry} industry.`;
        if (input.brief.description) {
            return `${baseSummary} ${input.brief.description}`;
        }
        // Extract key points from research
        const keyPoints = companyData.slice(0, 2).map(d => d.content.substring(0, 100));
        return `${baseSummary} Based on available information: ${keyPoints.join('. ')}`;
    }
    generateIndustryOverview(industryData) {
        // Generate industry overview from research
        const trends = industryData.slice(0, 3).map(d => d.content.substring(0, 150));
        return `The industry shows these key trends: ${trends.join('. ')}`;
    }
    identifyRisks(input, industryData) {
        const risks = [];
        // Common industry risks
        if (input.brief.constraints) {
            risks.push(...input.brief.constraints);
        }
        // Extract risks from industry data
        const riskKeywords = ['risk', 'challenge', 'threat', 'concern'];
        const content = industryData.map(d => d.content).join(' ').toLowerCase();
        for (const keyword of riskKeywords) {
            if (content.includes(keyword)) {
                risks.push(`Industry ${keyword} identified in market analysis`);
            }
        }
        return risks.slice(0, 3);
    }
    identifyOpportunities(input, industryData) {
        const opportunities = [];
        // Extract opportunities from industry data
        const oppKeywords = ['opportunity', 'growth', 'trend', 'innovation'];
        const content = industryData.map(d => d.content).join(' ').toLowerCase();
        for (const keyword of oppKeywords) {
            if (content.includes(keyword)) {
                opportunities.push(`Industry ${keyword} identified in market analysis`);
            }
        }
        // Add goal-based opportunities
        if (input.brief.goals) {
            opportunities.push(...input.brief.goals.map(g => `Opportunity to achieve: ${g}`));
        }
        return opportunities.slice(0, 3);
    }
    async compileSources(companyData, industryData, competitorData) {
        const allData = [...companyData, ...industryData, ...competitorData];
        const sources = [];
        const seen = new Set();
        for (const data of allData) {
            if (data.url && !seen.has(data.url)) {
                const query = 'query' in data ? data.query : undefined;
                const timestamp = 'timestamp' in data ? data.timestamp : undefined;
                sources.push({
                    url: data.url,
                    title: `Research: ${query || 'Industry Analysis'}`,
                    relevance: 'High',
                    accessedAt: timestamp || new Date().toISOString()
                });
                seen.add(data.url);
            }
        }
        return sources.slice(0, 10);
    }
}
exports.ResearchAgent = ResearchAgent;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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cC9hZ2VudHMvcmVzZWFyY2gvcmVzZWFyY2gtYWdlbnQudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUmVzZWFyY2hJbnB1dCwgUmVzZWFyY2hPdXRwdXQsIFNvdXJjZSwgU2VhcmNoUmVzdWx0LCBDb21wZXRpdG9yLCBUZWNoU3RhY2ssIFJlc2VhcmNoRG9zc2llciB9IGZyb20gJy4vdHlwZXMnO1xuaW1wb3J0IHsgd2ViZmV0Y2ggfSBmcm9tICcuLi8uLi90b29scy93ZWJmZXRjaCc7XG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tICcuLi8uLi9zcmMvcnVudGltZS9sb2dnZXInO1xuaW1wb3J0IHsgRGF0YWJhc2UgfSBmcm9tICcuLi8uLi9zcmMvZGF0YWJhc2UvdHlwZXMnO1xuaW1wb3J0IHsgSnNvbkRhdGFiYXNlIH0gZnJvbSAnLi4vLi4vc3JjL2RhdGFiYXNlL2pzb24tZGInO1xuaW1wb3J0IHsgUmVzZWFyY2hHYXRla2VlcGVyIH0gZnJvbSAnLi4vLi4vc3JjL2dvdmVybmFuY2UvZ2F0ZWtlZXBlcic7XG5pbXBvcnQgeyB2NCBhcyB1dWlkdjQgfSBmcm9tICd1dWlkJztcblxuZXhwb3J0IGNsYXNzIFJlc2VhcmNoQWdlbnQge1xuICBwcml2YXRlIHJlYWRvbmx5IGFnZW50TmFtZSA9ICdyZXNlYXJjaC1hZ2VudCc7XG4gIHByaXZhdGUgcmVhZG9ubHkgcHJvbXB0VmVyc2lvbiA9ICd2MSc7XG4gIHByaXZhdGUgcmVhZG9ubHkgbWNwVmVyc2lvbiA9ICd2MSc7XG4gIHByaXZhdGUgZGI6IERhdGFiYXNlO1xuICBwcml2YXRlIGdhdGVrZWVwZXI6IFJlc2VhcmNoR2F0ZWtlZXBlcjtcblxuICBjb25zdHJ1Y3RvcihkYj86IERhdGFiYXNlLCBnYXRla2VlcGVyPzogUmVzZWFyY2hHYXRla2VlcGVyKSB7XG4gICAgdGhpcy5kYiA9IGRiIHx8IG5ldyBKc29uRGF0YWJhc2UoKTtcbiAgICB0aGlzLmdhdGVrZWVwZXIgPSBnYXRla2VlcGVyIHx8IG5ldyBSZXNlYXJjaEdhdGVrZWVwZXIoKTtcbiAgfVxuXG4gIGFzeW5jIGV4ZWN1dGUoaW5wdXQ6IFJlc2VhcmNoSW5wdXQpOiBQcm9taXNlPFJlc2VhcmNoT3V0cHV0PiB7XG4gICAgY29uc3QgcnVuSWQgPSB0aGlzLmdlbmVyYXRlUnVuSWQoKTtcbiAgICBjb25zdCB0aW1lc3RhbXAgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG5cbiAgICBsb2dnZXIuaW5mbygnUmVzZWFyY2ggQWdlbnQgc3RhcnRlZCcsIHsgcnVuSWQsIGNvbXBhbnk6IGlucHV0LmJyaWVmLmNvbXBhbnkgfSk7XG5cbiAgICAvLyBJbml0aWFsaXplIFJlc2VhcmNoIFJlY29yZCBpbiBEYXRhYmFzZVxuICAgIGNvbnN0IHJlY29yZElkID0gdXVpZHY0KCk7XG4gICAgYXdhaXQgdGhpcy5kYi5zYXZlUmVzZWFyY2goe1xuICAgICAgaWQ6IHJlY29yZElkLFxuICAgICAgdG9waWM6IGlucHV0LmJyaWVmLmNvbXBhbnksXG4gICAgICBzdGF0dXM6ICdpbl9wcm9ncmVzcycsXG4gICAgICBzdGFydGVkQXQ6IHRpbWVzdGFtcCxcbiAgICAgIGZpbmRpbmdzOiBbXVxuICAgIH0pO1xuXG4gICAgbGV0IGl0ZXJhdGlvbnMgPSAwO1xuICAgIGNvbnN0IG1heEl0ZXJhdGlvbnMgPSAzO1xuICAgIGxldCBjb21wYW55RGF0YTogU2VhcmNoUmVzdWx0W10gPSBbXTtcbiAgICBsZXQgaW5kdXN0cnlEYXRhOiBTZWFyY2hSZXN1bHRbXSA9IFtdO1xuICAgIGxldCBjb21wZXRpdG9yRGF0YTogQ29tcGV0aXRvcltdID0gW107XG4gICAgbGV0IHRlY2hTdGFja0RhdGE6IFRlY2hTdGFjayA9IHsgZnJvbnRlbmQ6IFtdLCBiYWNrZW5kOiBbXSwgaW5mcmFzdHJ1Y3R1cmU6IFtdLCB0aGlyZFBhcnR5OiBbXSB9O1xuICAgIGxldCBzb3VyY2VzOiBTb3VyY2VbXSA9IFtdO1xuXG4gICAgLy8gUmVzZWFyY2ggTG9vcFxuICAgIGxldCBnYXRlUGFzc2VkID0gZmFsc2U7XG4gICAgd2hpbGUgKGl0ZXJhdGlvbnMgPCBtYXhJdGVyYXRpb25zKSB7XG4gICAgICBpdGVyYXRpb25zKys7XG4gICAgICBsb2dnZXIuaW5mbyhgUmVzZWFyY2ggaXRlcmF0aW9uICR7aXRlcmF0aW9uc30vJHttYXhJdGVyYXRpb25zfWApO1xuXG4gICAgICAvLyBSZWZpbmUgcXVlcmllcyBiYXNlZCBvbiBpdGVyYXRpb25cbiAgICAgIGNvbnN0IGl0ZXJhdGlvblN1ZmZpeCA9IGl0ZXJhdGlvbnMgPiAxID8gYCBkZXB0aCAke2l0ZXJhdGlvbnN9YCA6ICcnO1xuXG4gICAgICAvLyBHYXRoZXIgcmVzZWFyY2ggZGF0YVxuICAgICAgY29uc3QgW25ld0NvbXBhbnlEYXRhLCBuZXdJbmR1c3RyeURhdGEsIG5ld0NvbXBldGl0b3JEYXRhLCBuZXdUZWNoU3RhY2tEYXRhXSA9IGF3YWl0IFByb21pc2UuYWxsKFtcbiAgICAgICAgdGhpcy5nYXRoZXJDb21wYW55RGF0YShpbnB1dCwgaXRlcmF0aW9uU3VmZml4KSxcbiAgICAgICAgdGhpcy5nYXRoZXJJbmR1c3RyeURhdGEoaW5wdXQsIGl0ZXJhdGlvblN1ZmZpeCksXG4gICAgICAgIHRoaXMuZ2F0aGVyQ29tcGV0aXRvckRhdGEoaW5wdXQsIGl0ZXJhdGlvblN1ZmZpeCksXG4gICAgICAgIHRoaXMuZ2F0aGVyVGVjaFN0YWNrRGF0YShpbnB1dCwgaXRlcmF0aW9uU3VmZml4KVxuICAgICAgXSk7XG5cbiAgICAgIGNvbXBhbnlEYXRhID0gWy4uLmNvbXBhbnlEYXRhLCAuLi5uZXdDb21wYW55RGF0YV07XG4gICAgICBpbmR1c3RyeURhdGEgPSBbLi4uaW5kdXN0cnlEYXRhLCAuLi5uZXdJbmR1c3RyeURhdGFdO1xuICAgICAgLy8gQ29tcGV0aXRvcnMgYW5kIHRlY2ggc3RhY2sgbWlnaHQgZHVwbGljYXRlLCBidXQgZXh0cmFjdG9ycyBoYW5kbGUgc29tZSBsb2dpYy5cbiAgICAgIC8vIEZvciBzaW1wbGljaXR5IGluIHRoaXMgbG9vcCwgd2UganVzdCB0YWtlIHRoZSBsYXRlc3Qgb3IgbWVyZ2UgdW5pcXVlLlxuICAgICAgY29tcGV0aXRvckRhdGEgPSBuZXdDb21wZXRpdG9yRGF0YS5sZW5ndGggPiAwID8gbmV3Q29tcGV0aXRvckRhdGEgOiBjb21wZXRpdG9yRGF0YTtcbiAgICAgIHRlY2hTdGFja0RhdGEgPSAobmV3VGVjaFN0YWNrRGF0YS5mcm9udGVuZCAmJiBuZXdUZWNoU3RhY2tEYXRhLmZyb250ZW5kLmxlbmd0aCA+IDApID8gbmV3VGVjaFN0YWNrRGF0YSA6IHRlY2hTdGFja0RhdGE7XG5cbiAgICAgIC8vIENvbXBpbGUgc291cmNlcyBmb3IgZ2F0ZWtlZXBlclxuICAgICAgc291cmNlcyA9IGF3YWl0IHRoaXMuY29tcGlsZVNvdXJjZXMoY29tcGFueURhdGEsIGluZHVzdHJ5RGF0YSwgY29tcGV0aXRvckRhdGEpO1xuXG4gICAgICAvLyBDaGVjayBHYXRla2VlcGVyXG4gICAgICBjb25zdCBnYXRlUmVzdWx0ID0gdGhpcy5nYXRla2VlcGVyLmV2YWx1YXRlKHNvdXJjZXMpO1xuICAgICAgaWYgKGdhdGVSZXN1bHQucGFzc2VkKSB7XG4gICAgICAgIGxvZ2dlci5pbmZvKCdHYXRla2VlcGVyIHBhc3NlZCcsIHsgaXRlcmF0aW9ucywgc2NvcmU6IGdhdGVSZXN1bHQuc2NvcmUgfSk7XG4gICAgICAgIGdhdGVQYXNzZWQgPSB0cnVlO1xuICAgICAgICBicmVhaztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxvZ2dlci5pbmZvKCdHYXRla2VlcGVyIGZhaWxlZCwgY29udGludWluZyByZXNlYXJjaCcsIHsgaXRlcmF0aW9ucywgcmVhc29uczogZ2F0ZVJlc3VsdC5yZWFzb25zIH0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIFNhdmUgRmluZGluZ3MgdG8gREJcbiAgICBjb25zdCBjdXJyZW50UmVjb3JkID0gYXdhaXQgdGhpcy5kYi5nZXRSZXNlYXJjaChyZWNvcmRJZCk7XG4gICAgaWYgKGN1cnJlbnRSZWNvcmQpIHtcbiAgICAgICAgY3VycmVudFJlY29yZC5maW5kaW5ncyA9IHNvdXJjZXMubWFwKHMgPT4gKHtcbiAgICAgICAgICAgIGlkOiB1dWlkdjQoKSxcbiAgICAgICAgICAgIHNvdXJjZVVybDogcy51cmwsXG4gICAgICAgICAgICBjb250ZW50OiBzLnRpdGxlLFxuICAgICAgICAgICAgdGltZXN0YW1wOiBzLmFjY2Vzc2VkQXQsXG4gICAgICAgICAgICByZWxldmFuY2VTY29yZTogMVxuICAgICAgICB9KSk7XG5cbiAgICAgICAgaWYgKGdhdGVQYXNzZWQpIHtcbiAgICAgICAgICBjdXJyZW50UmVjb3JkLnN0YXR1cyA9ICdjb21wbGV0ZWQnO1xuICAgICAgICAgIGN1cnJlbnRSZWNvcmQuY29tcGxldGVkQXQgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY3VycmVudFJlY29yZC5zdGF0dXMgPSAnaW5fcHJvZ3Jlc3MnOyAvLyBPciAnZmFpbGVkJyBpZiBzdHJpY3RcbiAgICAgICAgICAvLyBXZSBrZWVwIGl0IGluX3Byb2dyZXNzIG9yIG1heWJlIGFkZCBhICdyZXZpZXdfbmVlZGVkJyBzdGF0dXM/XG4gICAgICAgICAgLy8gS2VlcGluZyBpbl9wcm9ncmVzcyBpbXBsaWVzIGl0J3Mgbm90IGRvbmUuXG4gICAgICAgIH1cblxuICAgICAgICBhd2FpdCB0aGlzLmRiLnNhdmVSZXNlYXJjaChjdXJyZW50UmVjb3JkKTtcbiAgICB9XG5cbiAgICAvLyBHZW5lcmF0ZSBzdW1tYXJpZXMgYW5kIGFuYWx5c2lzXG4gICAgY29uc3QgY29tcGFueVN1bW1hcnkgPSB0aGlzLmdlbmVyYXRlQ29tcGFueVN1bW1hcnkoY29tcGFueURhdGEsIGlucHV0KTtcbiAgICBjb25zdCBpbmR1c3RyeU92ZXJ2aWV3ID0gdGhpcy5nZW5lcmF0ZUluZHVzdHJ5T3ZlcnZpZXcoaW5kdXN0cnlEYXRhKTtcbiAgICBjb25zdCByaXNrcyA9IHRoaXMuaWRlbnRpZnlSaXNrcyhpbnB1dCwgaW5kdXN0cnlEYXRhKTtcbiAgICBjb25zdCBvcHBvcnR1bml0aWVzID0gdGhpcy5pZGVudGlmeU9wcG9ydHVuaXRpZXMoaW5wdXQsIGluZHVzdHJ5RGF0YSk7XG5cbiAgICAvLyBDb21waWxlIGRvc3NpZXJcbiAgICBjb25zdCBkb3NzaWVyOiBSZXNlYXJjaERvc3NpZXIgPSB7XG4gICAgICBjb21wYW55U3VtbWFyeTogY29tcGFueVN1bW1hcnksXG4gICAgICBpbmR1c3RyeU92ZXJ2aWV3OiBpbmR1c3RyeU92ZXJ2aWV3LFxuICAgICAgY29tcGV0aXRvcnM6IGNvbXBldGl0b3JEYXRhLFxuICAgICAgdGVjaFN0YWNrOiB0ZWNoU3RhY2tEYXRhLFxuICAgICAgcmlza3M6IHJpc2tzLFxuICAgICAgb3Bwb3J0dW5pdGllczogb3Bwb3J0dW5pdGllcyxcbiAgICAgIHJlY29tbWVuZGF0aW9uczogW1xuICAgICAgICAnQWRkcmVzcyBpZGVudGlmaWVkIHJpc2tzIHRocm91Z2ggbWl0aWdhdGlvbiBzdHJhdGVnaWVzJyxcbiAgICAgICAgJ0xldmVyYWdlIGlkZW50aWZpZWQgb3Bwb3J0dW5pdGllcyBmb3IgY29tcGV0aXRpdmUgYWR2YW50YWdlJ1xuICAgICAgXVxuICAgIH07XG5cbiAgICBsb2dnZXIuaW5mbygnUmVzZWFyY2ggQWdlbnQgY29tcGxldGVkJywgeyBydW5JZCwgc291cmNlc0NvdW50OiBzb3VyY2VzLmxlbmd0aCB9KTtcblxuICAgIHJldHVybiB7XG4gICAgICBkb3NzaWVyLFxuICAgICAgc291cmNlcyxcbiAgICAgIG1ldGE6IHtcbiAgICAgICAgYWdlbnQ6IHRoaXMuYWdlbnROYW1lLFxuICAgICAgICBwcm9tcHRWZXJzaW9uOiB0aGlzLnByb21wdFZlcnNpb24sXG4gICAgICAgIG1jcFZlcnNpb246IHRoaXMubWNwVmVyc2lvbixcbiAgICAgICAgdGltZXN0YW1wLFxuICAgICAgICBydW5JZFxuICAgICAgfVxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGdlbmVyYXRlUnVuSWQoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gYHJlc2VhcmNoLSR7RGF0ZS5ub3coKX0tJHtNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHJpbmcoMiwgMTEpfWA7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGdhdGhlckNvbXBhbnlEYXRhKGlucHV0OiBSZXNlYXJjaElucHV0LCBzdWZmaXg6IHN0cmluZyA9ICcnKTogUHJvbWlzZTxTZWFyY2hSZXN1bHRbXT4ge1xuICAgIC8vIFNlYXJjaCBmb3IgY29tcGFueSBpbmZvcm1hdGlvblxuICAgIGNvbnN0IHNlYXJjaFF1ZXJpZXMgPSBbXG4gICAgICBgJHtpbnB1dC5icmllZi5jb21wYW55fSBjb21wYW55IG92ZXJ2aWV3JHtzdWZmaXh9YCxcbiAgICAgIGAke2lucHV0LmJyaWVmLmNvbXBhbnl9IGFib3V0IHVzJHtzdWZmaXh9YCxcbiAgICAgIGAke2lucHV0LmJyaWVmLmNvbXBhbnl9IG1pc3Npb24gdmlzaW9uJHtzdWZmaXh9YFxuICAgIF07XG5cbiAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGwoXG4gICAgICBzZWFyY2hRdWVyaWVzLm1hcChxdWVyeSA9PiB0aGlzLnNlYXJjaFdlYihxdWVyeSkpXG4gICAgKTtcblxuICAgIHJldHVybiByZXN1bHRzLmZsYXQoKTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZ2F0aGVySW5kdXN0cnlEYXRhKGlucHV0OiBSZXNlYXJjaElucHV0LCBzdWZmaXg6IHN0cmluZyA9ICcnKTogUHJvbWlzZTxTZWFyY2hSZXN1bHRbXT4ge1xuICAgIGNvbnN0IGluZHVzdHJ5UXVlcmllcyA9IFtcbiAgICAgIGAke2lucHV0LmJyaWVmLmluZHVzdHJ5fSBpbmR1c3RyeSB0cmVuZHMgMjAyNCR7c3VmZml4fWAsXG4gICAgICBgJHtpbnB1dC5icmllZi5pbmR1c3RyeX0gbWFya2V0IGFuYWx5c2lzJHtzdWZmaXh9YCxcbiAgICAgIGAke2lucHV0LmJyaWVmLmluZHVzdHJ5fSB0ZWNobm9sb2d5IGFkb3B0aW9uJHtzdWZmaXh9YFxuICAgIF07XG5cbiAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGwoXG4gICAgICBpbmR1c3RyeVF1ZXJpZXMubWFwKHF1ZXJ5ID0+IHRoaXMuc2VhcmNoV2ViKHF1ZXJ5KSlcbiAgICApO1xuXG4gICAgcmV0dXJuIHJlc3VsdHMuZmxhdCgpO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBnYXRoZXJDb21wZXRpdG9yRGF0YShpbnB1dDogUmVzZWFyY2hJbnB1dCwgc3VmZml4OiBzdHJpbmcgPSAnJyk6IFByb21pc2U8Q29tcGV0aXRvcltdPiB7XG4gICAgY29uc3QgY29tcGV0aXRvclF1ZXJpZXMgPSBbXG4gICAgICBgJHtpbnB1dC5icmllZi5pbmR1c3RyeX0gdG9wIGNvbXBldGl0b3JzJHtzdWZmaXh9YCxcbiAgICAgIGAke2lucHV0LmJyaWVmLmNvbXBhbnl9IGNvbXBldGl0b3JzJHtzdWZmaXh9YCxcbiAgICAgIGAke2lucHV0LmJyaWVmLmluZHVzdHJ5fSBtYXJrZXQgbGVhZGVycyR7c3VmZml4fWBcbiAgICBdO1xuXG4gICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IFByb21pc2UuYWxsKFxuICAgICAgY29tcGV0aXRvclF1ZXJpZXMubWFwKHF1ZXJ5ID0+IHRoaXMuc2VhcmNoV2ViKHF1ZXJ5KSlcbiAgICApO1xuXG4gICAgcmV0dXJuIHRoaXMuZXh0cmFjdENvbXBldGl0b3JzKHJlc3VsdHMuZmxhdCgpLCBpbnB1dCk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGdhdGhlclRlY2hTdGFja0RhdGEoaW5wdXQ6IFJlc2VhcmNoSW5wdXQsIHN1ZmZpeDogc3RyaW5nID0gJycpOiBQcm9taXNlPFRlY2hTdGFjaz4ge1xuICAgIGNvbnN0IHRlY2hRdWVyaWVzID0gW1xuICAgICAgYCR7aW5wdXQuYnJpZWYuY29tcGFueX0gdGVjaCBzdGFjayR7c3VmZml4fWAsXG4gICAgICBgJHtpbnB1dC5icmllZi5jb21wYW55fSB0ZWNobm9sb2d5JHtzdWZmaXh9YCxcbiAgICAgIGAke2lucHV0LmJyaWVmLmluZHVzdHJ5fSBjb21tb24gdGVjaCBzdGFjayR7c3VmZml4fWBcbiAgICBdO1xuXG4gICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IFByb21pc2UuYWxsKFxuICAgICAgdGVjaFF1ZXJpZXMubWFwKHF1ZXJ5ID0+IHRoaXMuc2VhcmNoV2ViKHF1ZXJ5KSlcbiAgICApO1xuXG4gICAgcmV0dXJuIHRoaXMuZXh0cmFjdFRlY2hTdGFjayhyZXN1bHRzLmZsYXQoKSk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHNlYXJjaFdlYihxdWVyeTogc3RyaW5nKTogUHJvbWlzZTxTZWFyY2hSZXN1bHRbXT4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBVc2Ugd2ViZmV0Y2ggdG9vbCB0byBzZWFyY2ggdmlhIER1Y2tEdWNrR28gSFRNTCAobW9yZSByZWxpYWJsZSBmb3Igc2NyYXBpbmcpXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB3ZWJmZXRjaChgaHR0cHM6Ly9odG1sLmR1Y2tkdWNrZ28uY29tL2h0bWwvP3E9JHtlbmNvZGVVUklDb21wb25lbnQocXVlcnkpfWAsICd0ZXh0Jyk7XG4gICAgICBcbiAgICAgIHJldHVybiBbe1xuICAgICAgICBxdWVyeSxcbiAgICAgICAgY29udGVudDogcmVzdWx0LmNvbnRlbnQsXG4gICAgICAgIHVybDogcmVzdWx0LnVybCxcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgICAgIH1dO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIud2FybihgU2VhcmNoIGZhaWxlZCBmb3IgcXVlcnk6ICR7cXVlcnl9YCwgeyBlcnJvciwgcXVlcnkgfSk7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBleHRyYWN0Q29tcGV0aXRvcnMoZGF0YTogU2VhcmNoUmVzdWx0W10sIGlucHV0OiBSZXNlYXJjaElucHV0KTogQ29tcGV0aXRvcltdIHtcbiAgICAvLyBFeHRyYWN0IGNvbXBldGl0b3IgaW5mb3JtYXRpb24gZnJvbSBzZWFyY2ggcmVzdWx0c1xuICAgIGNvbnN0IGNvbXBldGl0b3JzOiBDb21wZXRpdG9yW10gPSBbXTtcbiAgICBjb25zdCBzZWVuID0gbmV3IFNldDxzdHJpbmc+KCk7XG5cbiAgICBmb3IgKGNvbnN0IHJlc3VsdCBvZiBkYXRhKSB7XG4gICAgICAvLyBTaW1wbGUgZXh0cmFjdGlvbiBsb2dpYyAtIGluIHByb2R1Y3Rpb24sIHVzZSBtb3JlIHNvcGhpc3RpY2F0ZWQgTkxQXG4gICAgICBjb25zdCBsaW5lcyA9IHJlc3VsdC5jb250ZW50LnNwbGl0KCdcXG4nKTtcbiAgICAgIFxuICAgICAgZm9yIChjb25zdCBsaW5lIG9mIGxpbmVzKSB7XG4gICAgICAgIGlmIChsaW5lLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoJ2NvbXBldGl0b3InKSB8fCBcbiAgICAgICAgICAgIGxpbmUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcygnY29tcGV0aXRpb24nKSB8fFxuICAgICAgICAgICAgbGluZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKCdhbHRlcm5hdGl2ZScpKSB7XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gRXh0cmFjdCBjb21wYW55IG5hbWVzIChzaW1wbGUgaGV1cmlzdGljKVxuICAgICAgICAgIGNvbnN0IHdvcmRzID0gbGluZS5zcGxpdCgnICcpO1xuICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgd29yZHMubGVuZ3RoIC0gMTsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCBwb3RlbnRpYWxDb21wYW55ID0gd29yZHNbaV0gKyAnICcgKyB3b3Jkc1tpICsgMV07XG4gICAgICAgICAgICBpZiAocG90ZW50aWFsQ29tcGFueS5sZW5ndGggPiAzICYmIFxuICAgICAgICAgICAgICAgICFwb3RlbnRpYWxDb21wYW55LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoaW5wdXQuYnJpZWYuY29tcGFueS50b0xvd2VyQ2FzZSgpKSAmJlxuICAgICAgICAgICAgICAgICFzZWVuLmhhcyhwb3RlbnRpYWxDb21wYW55KSkge1xuICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgY29tcGV0aXRvcnMucHVzaCh7XG4gICAgICAgICAgICAgICAgbmFtZTogcG90ZW50aWFsQ29tcGFueSxcbiAgICAgICAgICAgICAgICB1cmw6IHJlc3VsdC51cmwsXG4gICAgICAgICAgICAgICAgZGlmZmVyZW50aWF0aW9uOiAnTWFya2V0IGNvbXBldGl0b3InLFxuICAgICAgICAgICAgICAgIG1hcmtldFBvc2l0aW9uOiAnRXN0YWJsaXNoZWQgcGxheWVyJ1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgc2Vlbi5hZGQocG90ZW50aWFsQ29tcGFueSk7XG4gICAgICAgICAgICAgIFxuICAgICAgICAgICAgICBpZiAoY29tcGV0aXRvcnMubGVuZ3RoID49IDUpIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoY29tcGV0aXRvcnMubGVuZ3RoID49IDUpIGJyZWFrO1xuICAgICAgfVxuICAgICAgaWYgKGNvbXBldGl0b3JzLmxlbmd0aCA+PSA1KSBicmVhaztcbiAgICB9XG5cbiAgICByZXR1cm4gY29tcGV0aXRvcnMuc2xpY2UoMCwgNSk7XG4gIH1cblxuICBwcml2YXRlIGV4dHJhY3RUZWNoU3RhY2soZGF0YTogU2VhcmNoUmVzdWx0W10pOiBUZWNoU3RhY2sge1xuICAgIGNvbnN0IHRlY2hTdGFjazogVGVjaFN0YWNrID0ge1xuICAgICAgZnJvbnRlbmQ6IFtdLFxuICAgICAgYmFja2VuZDogW10sXG4gICAgICBpbmZyYXN0cnVjdHVyZTogW10sXG4gICAgICB0aGlyZFBhcnR5OiBbXVxuICAgIH07XG5cbiAgICBjb25zdCBjb21tb25UZWNoID0ge1xuICAgICAgZnJvbnRlbmQ6IFsnUmVhY3QnLCAnVnVlJywgJ0FuZ3VsYXInLCAnTmV4dC5qcycsICdTdmVsdGUnXSxcbiAgICAgIGJhY2tlbmQ6IFsnTm9kZS5qcycsICdQeXRob24nLCAnSmF2YScsICdHbycsICdSdWJ5JywgJ1BIUCddLFxuICAgICAgaW5mcmFzdHJ1Y3R1cmU6IFsnQVdTJywgJ0F6dXJlJywgJ0dvb2dsZSBDbG91ZCcsICdEb2NrZXInLCAnS3ViZXJuZXRlcyddLFxuICAgICAgdGhpcmRQYXJ0eTogWydTdHJpcGUnLCAnVHdpbGlvJywgJ1NlbmRHcmlkJywgJ0F1dGgwJywgJ0ZpcmViYXNlJ11cbiAgICB9O1xuXG4gICAgY29uc3QgY29udGVudCA9IGRhdGEubWFwKGQgPT4gZC5jb250ZW50KS5qb2luKCcgJykudG9Mb3dlckNhc2UoKTtcblxuICAgIC8vIEV4dHJhY3QgdGVjaG5vbG9naWVzXG4gICAgZm9yIChjb25zdCBbY2F0ZWdvcnksIHRlY2hzXSBvZiBPYmplY3QuZW50cmllcyhjb21tb25UZWNoKSkge1xuICAgICAgZm9yIChjb25zdCB0ZWNoIG9mIHRlY2hzKSB7XG4gICAgICAgIGlmIChjb250ZW50LmluY2x1ZGVzKHRlY2gudG9Mb3dlckNhc2UoKSkpIHtcbiAgICAgICAgICBjb25zdCBjYXRlZ29yeUtleSA9IGNhdGVnb3J5IGFzIGtleW9mIFRlY2hTdGFjaztcbiAgICAgICAgICBpZiAodGVjaFN0YWNrW2NhdGVnb3J5S2V5XSkge1xuICAgICAgICAgICAgdGVjaFN0YWNrW2NhdGVnb3J5S2V5XSEucHVzaCh0ZWNoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdGVjaFN0YWNrO1xuICB9XG5cbiAgcHJpdmF0ZSBnZW5lcmF0ZUNvbXBhbnlTdW1tYXJ5KGNvbXBhbnlEYXRhOiBTZWFyY2hSZXN1bHRbXSwgaW5wdXQ6IFJlc2VhcmNoSW5wdXQpOiBzdHJpbmcge1xuICAgIC8vIEdlbmVyYXRlIGEgMy01IHNlbnRlbmNlIHN1bW1hcnlcbiAgICBjb25zdCBiYXNlU3VtbWFyeSA9IGAke2lucHV0LmJyaWVmLmNvbXBhbnl9IG9wZXJhdGVzIGluIHRoZSAke2lucHV0LmJyaWVmLmluZHVzdHJ5fSBpbmR1c3RyeS5gO1xuICAgIFxuICAgIGlmIChpbnB1dC5icmllZi5kZXNjcmlwdGlvbikge1xuICAgICAgcmV0dXJuIGAke2Jhc2VTdW1tYXJ5fSAke2lucHV0LmJyaWVmLmRlc2NyaXB0aW9ufWA7XG4gICAgfVxuXG4gICAgLy8gRXh0cmFjdCBrZXkgcG9pbnRzIGZyb20gcmVzZWFyY2hcbiAgICBjb25zdCBrZXlQb2ludHMgPSBjb21wYW55RGF0YS5zbGljZSgwLCAyKS5tYXAoZCA9PiBkLmNvbnRlbnQuc3Vic3RyaW5nKDAsIDEwMCkpO1xuICAgIHJldHVybiBgJHtiYXNlU3VtbWFyeX0gQmFzZWQgb24gYXZhaWxhYmxlIGluZm9ybWF0aW9uOiAke2tleVBvaW50cy5qb2luKCcuICcpfWA7XG4gIH1cblxuICBwcml2YXRlIGdlbmVyYXRlSW5kdXN0cnlPdmVydmlldyhpbmR1c3RyeURhdGE6IFNlYXJjaFJlc3VsdFtdKTogc3RyaW5nIHtcbiAgICAvLyBHZW5lcmF0ZSBpbmR1c3RyeSBvdmVydmlldyBmcm9tIHJlc2VhcmNoXG4gICAgY29uc3QgdHJlbmRzID0gaW5kdXN0cnlEYXRhLnNsaWNlKDAsIDMpLm1hcChkID0+IGQuY29udGVudC5zdWJzdHJpbmcoMCwgMTUwKSk7XG4gICAgcmV0dXJuIGBUaGUgaW5kdXN0cnkgc2hvd3MgdGhlc2Uga2V5IHRyZW5kczogJHt0cmVuZHMuam9pbignLiAnKX1gO1xuICB9XG5cbiAgcHJpdmF0ZSBpZGVudGlmeVJpc2tzKGlucHV0OiBSZXNlYXJjaElucHV0LCBpbmR1c3RyeURhdGE6IFNlYXJjaFJlc3VsdFtdKTogc3RyaW5nW10ge1xuICAgIGNvbnN0IHJpc2tzID0gW107XG4gICAgXG4gICAgLy8gQ29tbW9uIGluZHVzdHJ5IHJpc2tzXG4gICAgaWYgKGlucHV0LmJyaWVmLmNvbnN0cmFpbnRzKSB7XG4gICAgICByaXNrcy5wdXNoKC4uLmlucHV0LmJyaWVmLmNvbnN0cmFpbnRzKTtcbiAgICB9XG5cbiAgICAvLyBFeHRyYWN0IHJpc2tzIGZyb20gaW5kdXN0cnkgZGF0YVxuICAgIGNvbnN0IHJpc2tLZXl3b3JkcyA9IFsncmlzaycsICdjaGFsbGVuZ2UnLCAndGhyZWF0JywgJ2NvbmNlcm4nXTtcbiAgICBjb25zdCBjb250ZW50ID0gaW5kdXN0cnlEYXRhLm1hcChkID0+IGQuY29udGVudCkuam9pbignICcpLnRvTG93ZXJDYXNlKCk7XG4gICAgXG4gICAgZm9yIChjb25zdCBrZXl3b3JkIG9mIHJpc2tLZXl3b3Jkcykge1xuICAgICAgaWYgKGNvbnRlbnQuaW5jbHVkZXMoa2V5d29yZCkpIHtcbiAgICAgICAgcmlza3MucHVzaChgSW5kdXN0cnkgJHtrZXl3b3JkfSBpZGVudGlmaWVkIGluIG1hcmtldCBhbmFseXNpc2ApO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiByaXNrcy5zbGljZSgwLCAzKTtcbiAgfVxuXG4gIHByaXZhdGUgaWRlbnRpZnlPcHBvcnR1bml0aWVzKGlucHV0OiBSZXNlYXJjaElucHV0LCBpbmR1c3RyeURhdGE6IFNlYXJjaFJlc3VsdFtdKTogc3RyaW5nW10ge1xuICAgIGNvbnN0IG9wcG9ydHVuaXRpZXMgPSBbXTtcbiAgICBcbiAgICAvLyBFeHRyYWN0IG9wcG9ydHVuaXRpZXMgZnJvbSBpbmR1c3RyeSBkYXRhXG4gICAgY29uc3Qgb3BwS2V5d29yZHMgPSBbJ29wcG9ydHVuaXR5JywgJ2dyb3d0aCcsICd0cmVuZCcsICdpbm5vdmF0aW9uJ107XG4gICAgY29uc3QgY29udGVudCA9IGluZHVzdHJ5RGF0YS5tYXAoZCA9PiBkLmNvbnRlbnQpLmpvaW4oJyAnKS50b0xvd2VyQ2FzZSgpO1xuICAgIFxuICAgIGZvciAoY29uc3Qga2V5d29yZCBvZiBvcHBLZXl3b3Jkcykge1xuICAgICAgaWYgKGNvbnRlbnQuaW5jbHVkZXMoa2V5d29yZCkpIHtcbiAgICAgICAgb3Bwb3J0dW5pdGllcy5wdXNoKGBJbmR1c3RyeSAke2tleXdvcmR9IGlkZW50aWZpZWQgaW4gbWFya2V0IGFuYWx5c2lzYCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQWRkIGdvYWwtYmFzZWQgb3Bwb3J0dW5pdGllc1xuICAgIGlmIChpbnB1dC5icmllZi5nb2Fscykge1xuICAgICAgb3Bwb3J0dW5pdGllcy5wdXNoKC4uLmlucHV0LmJyaWVmLmdvYWxzLm1hcChnID0+IGBPcHBvcnR1bml0eSB0byBhY2hpZXZlOiAke2d9YCkpO1xuICAgIH1cblxuICAgIHJldHVybiBvcHBvcnR1bml0aWVzLnNsaWNlKDAsIDMpO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBjb21waWxlU291cmNlcyhjb21wYW55RGF0YTogU2VhcmNoUmVzdWx0W10sIGluZHVzdHJ5RGF0YTogU2VhcmNoUmVzdWx0W10sIGNvbXBldGl0b3JEYXRhOiBDb21wZXRpdG9yW10pOiBQcm9taXNlPFNvdXJjZVtdPiB7XG4gICAgY29uc3QgYWxsRGF0YTogKFNlYXJjaFJlc3VsdCB8IENvbXBldGl0b3IpW10gPSBbLi4uY29tcGFueURhdGEsIC4uLmluZHVzdHJ5RGF0YSwgLi4uY29tcGV0aXRvckRhdGFdO1xuICAgIGNvbnN0IHNvdXJjZXM6IFNvdXJjZVtdID0gW107XG4gICAgY29uc3Qgc2VlbiA9IG5ldyBTZXQ8c3RyaW5nPigpO1xuXG4gICAgZm9yIChjb25zdCBkYXRhIG9mIGFsbERhdGEpIHtcbiAgICAgIGlmIChkYXRhLnVybCAmJiAhc2Vlbi5oYXMoZGF0YS51cmwpKSB7XG4gICAgICAgIGNvbnN0IHF1ZXJ5ID0gJ3F1ZXJ5JyBpbiBkYXRhID8gZGF0YS5xdWVyeSA6IHVuZGVmaW5lZDtcbiAgICAgICAgY29uc3QgdGltZXN0YW1wID0gJ3RpbWVzdGFtcCcgaW4gZGF0YSA/IGRhdGEudGltZXN0YW1wIDogdW5kZWZpbmVkO1xuICAgICAgICBcbiAgICAgICAgc291cmNlcy5wdXNoKHtcbiAgICAgICAgICB1cmw6IGRhdGEudXJsLFxuICAgICAgICAgIHRpdGxlOiBgUmVzZWFyY2g6ICR7cXVlcnkgfHwgJ0luZHVzdHJ5IEFuYWx5c2lzJ31gLFxuICAgICAgICAgIHJlbGV2YW5jZTogJ0hpZ2gnLFxuICAgICAgICAgIGFjY2Vzc2VkQXQ6IHRpbWVzdGFtcCB8fCBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgICAgICAgfSk7XG4gICAgICAgIHNlZW4uYWRkKGRhdGEudXJsKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gc291cmNlcy5zbGljZSgwLCAxMCk7XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==