2b3925dfad6e2d297399c6058502aaee
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.JsonDatabase = void 0;
const fs = __importStar(require("fs"));
const path = __importStar(require("path"));
class JsonDatabase {
    constructor(storageDir = 'data') {
        this.data = {};
        this.dbPath = path.join(storageDir, 'research_db.json');
        this.ensureDbExists(storageDir);
        this.load();
    }
    ensureDbExists(storageDir) {
        if (!fs.existsSync(storageDir)) {
            fs.mkdirSync(storageDir, { recursive: true });
        }
        if (!fs.existsSync(this.dbPath)) {
            fs.writeFileSync(this.dbPath, JSON.stringify({}, null, 2));
        }
    }
    load() {
        try {
            const content = fs.readFileSync(this.dbPath, 'utf-8');
            this.data = JSON.parse(content);
        }
        catch (error) {
            console.error('Failed to load database:', error);
            this.data = {};
        }
    }
    save() {
        try {
            fs.writeFileSync(this.dbPath, JSON.stringify(this.data, null, 2));
        }
        catch (error) {
            console.error('Failed to save database:', error);
        }
    }
    async saveResearch(record) {
        this.data[record.id] = record;
        this.save();
    }
    async getResearch(id) {
        return this.data[id] || null;
    }
    async getAllResearch() {
        return Object.values(this.data);
    }
    async addFinding(researchId, finding) {
        const record = this.data[researchId];
        if (record) {
            record.findings.push(finding);
            this.save();
        }
        else {
            throw new Error(`Research record ${researchId} not found`);
        }
    }
    async updateStatus(researchId, status) {
        const record = this.data[researchId];
        if (record) {
            record.status = status;
            if (status === 'completed') {
                record.completedAt = new Date().toISOString();
            }
            this.save();
        }
        else {
            throw new Error(`Research record ${researchId} not found`);
        }
    }
}
exports.JsonDatabase = JsonDatabase;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q0FBQyxtQkFBbUIsVUFBVSxZQUFZLENBQUMsQ0FBQztRQUM3RCxDQUFDO0lBQ0gsQ0FBQztJQUVELEtBQUssQ0FBQyxZQUFZLENBQUMsVUFBa0IsRUFBRSxNQUFnQztRQUNyRSxNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQ3JDLElBQUksTUFBTSxFQUFFLENBQUM7WUFDWCxNQUFNLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztZQUN2QixJQUFJLE1BQU0sS0FBSyxXQUFXLEVBQUUsQ0FBQztnQkFDM0IsTUFBTSxDQUFDLFdBQVcsR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQ2hELENBQUM7WUFDRCxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDZCxDQUFDO2FBQU0sQ0FBQztZQUNOLE1BQU0sSUFBSSxLQUFLLENBQUMsbUJBQW1CLFVBQVUsWUFBWSxDQUFDLENBQUM7UUFDN0QsQ0FBQztJQUNILENBQUM7Q0FDRjtBQXhFRCxvQ0F3RUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2FwcC9zcmMvZGF0YWJhc2UvanNvbi1kYi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBmcyBmcm9tICdmcyc7XG5pbXBvcnQgKiBhcyBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IHsgRGF0YWJhc2UsIFJlc2VhcmNoUmVjb3JkLCBSZXNlYXJjaEZpbmRpbmcgfSBmcm9tICcuL3R5cGVzJztcblxuZXhwb3J0IGNsYXNzIEpzb25EYXRhYmFzZSBpbXBsZW1lbnRzIERhdGFiYXNlIHtcbiAgcHJpdmF0ZSBkYlBhdGg6IHN0cmluZztcbiAgcHJpdmF0ZSBkYXRhOiBSZWNvcmQ8c3RyaW5nLCBSZXNlYXJjaFJlY29yZD4gPSB7fTtcblxuICBjb25zdHJ1Y3RvcihzdG9yYWdlRGlyOiBzdHJpbmcgPSAnZGF0YScpIHtcbiAgICB0aGlzLmRiUGF0aCA9IHBhdGguam9pbihzdG9yYWdlRGlyLCAncmVzZWFyY2hfZGIuanNvbicpO1xuICAgIHRoaXMuZW5zdXJlRGJFeGlzdHMoc3RvcmFnZURpcik7XG4gICAgdGhpcy5sb2FkKCk7XG4gIH1cblxuICBwcml2YXRlIGVuc3VyZURiRXhpc3RzKHN0b3JhZ2VEaXI6IHN0cmluZykge1xuICAgIGlmICghZnMuZXhpc3RzU3luYyhzdG9yYWdlRGlyKSkge1xuICAgICAgZnMubWtkaXJTeW5jKHN0b3JhZ2VEaXIsIHsgcmVjdXJzaXZlOiB0cnVlIH0pO1xuICAgIH1cbiAgICBpZiAoIWZzLmV4aXN0c1N5bmModGhpcy5kYlBhdGgpKSB7XG4gICAgICBmcy53cml0ZUZpbGVTeW5jKHRoaXMuZGJQYXRoLCBKU09OLnN0cmluZ2lmeSh7fSwgbnVsbCwgMikpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgbG9hZCgpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgY29udGVudCA9IGZzLnJlYWRGaWxlU3luYyh0aGlzLmRiUGF0aCwgJ3V0Zi04Jyk7XG4gICAgICB0aGlzLmRhdGEgPSBKU09OLnBhcnNlKGNvbnRlbnQpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gbG9hZCBkYXRhYmFzZTonLCBlcnJvcik7XG4gICAgICB0aGlzLmRhdGEgPSB7fTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHNhdmUoKSB7XG4gICAgdHJ5IHtcbiAgICAgIGZzLndyaXRlRmlsZVN5bmModGhpcy5kYlBhdGgsIEpTT04uc3RyaW5naWZ5KHRoaXMuZGF0YSwgbnVsbCwgMikpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gc2F2ZSBkYXRhYmFzZTonLCBlcnJvcik7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgc2F2ZVJlc2VhcmNoKHJlY29yZDogUmVzZWFyY2hSZWNvcmQpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0aGlzLmRhdGFbcmVjb3JkLmlkXSA9IHJlY29yZDtcbiAgICB0aGlzLnNhdmUoKTtcbiAgfVxuXG4gIGFzeW5jIGdldFJlc2VhcmNoKGlkOiBzdHJpbmcpOiBQcm9taXNlPFJlc2VhcmNoUmVjb3JkIHwgbnVsbD4ge1xuICAgIHJldHVybiB0aGlzLmRhdGFbaWRdIHx8IG51bGw7XG4gIH1cblxuICBhc3luYyBnZXRBbGxSZXNlYXJjaCgpOiBQcm9taXNlPFJlc2VhcmNoUmVjb3JkW10+IHtcbiAgICByZXR1cm4gT2JqZWN0LnZhbHVlcyh0aGlzLmRhdGEpO1xuICB9XG5cbiAgYXN5bmMgYWRkRmluZGluZyhyZXNlYXJjaElkOiBzdHJpbmcsIGZpbmRpbmc6IFJlc2VhcmNoRmluZGluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IHJlY29yZCA9IHRoaXMuZGF0YVtyZXNlYXJjaElkXTtcbiAgICBpZiAocmVjb3JkKSB7XG4gICAgICByZWNvcmQuZmluZGluZ3MucHVzaChmaW5kaW5nKTtcbiAgICAgIHRoaXMuc2F2ZSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFJlc2VhcmNoIHJlY29yZCAke3Jlc2VhcmNoSWR9IG5vdCBmb3VuZGApO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHVwZGF0ZVN0YXR1cyhyZXNlYXJjaElkOiBzdHJpbmcsIHN0YXR1czogUmVzZWFyY2hSZWNvcmRbJ3N0YXR1cyddKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgcmVjb3JkID0gdGhpcy5kYXRhW3Jlc2VhcmNoSWRdO1xuICAgIGlmIChyZWNvcmQpIHtcbiAgICAgIHJlY29yZC5zdGF0dXMgPSBzdGF0dXM7XG4gICAgICBpZiAoc3RhdHVzID09PSAnY29tcGxldGVkJykge1xuICAgICAgICByZWNvcmQuY29tcGxldGVkQXQgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG4gICAgICB9XG4gICAgICB0aGlzLnNhdmUoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBSZXNlYXJjaCByZWNvcmQgJHtyZXNlYXJjaElkfSBub3QgZm91bmRgKTtcbiAgICB9XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==