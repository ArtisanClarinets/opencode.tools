{"file":"/app/tools/webfetch.ts","mappings":";;;;;AAcA,4BA6CC;AA3DD;;GAEG;AACH,kDAA0B;AAC1B,+CAAuC;AAUhC,KAAK,UAAU,QAAQ,CAAC,GAAW,EAAE,SAAuC,UAAU;IAC3F,IAAI,CAAC;QACH,MAAM,QAAQ,GAAG,MAAM,eAAK,CAAC,GAAG,CAAC,GAAG,EAAE;YACpC,OAAO,EAAE;gBACP,YAAY,EAAE,2EAA2E;gBACzF,QAAQ,EAAE,4EAA4E;gBACtF,iBAAiB,EAAE,gBAAgB;aACpC;YACD,OAAO,EAAE,KAAK,EAAE,qBAAqB;YACrC,cAAc,EAAE,CAAC,MAAM,EAAE,EAAE,CAAC,MAAM,GAAG,GAAG,CAAC,oBAAoB;SAC9D,CAAC,CAAC;QAEH,MAAM,IAAI,GAAG,QAAQ,CAAC,IAAI,CAAC;QAC3B,IAAI,OAAO,GAAG,IAAI,CAAC;QAEnB,IAAI,MAAM,KAAK,UAAU,IAAI,MAAM,KAAK,MAAM,EAAE,CAAC;YAC/C,OAAO,GAAG,IAAA,sBAAO,EAAC,IAAI,EAAE;gBACtB,QAAQ,EAAE,GAAG;gBACb,SAAS,EAAE;oBACT,EAAE,QAAQ,EAAE,GAAG,EAAE,OAAO,EAAE,EAAE,UAAU,EAAE,IAAI,EAAE,EAAE;oBAChD,EAAE,QAAQ,EAAE,KAAK,EAAE,MAAM,EAAE,MAAM,EAAE;oBACnC,EAAE,QAAQ,EAAE,QAAQ,EAAE,MAAM,EAAE,MAAM,EAAE;oBACtC,EAAE,QAAQ,EAAE,OAAO,EAAE,MAAM,EAAE,MAAM,EAAE;oBACrC,EAAE,QAAQ,EAAE,KAAK,EAAE,MAAM,EAAE,MAAM,EAAE;oBACnC,EAAE,QAAQ,EAAE,QAAQ,EAAE,MAAM,EAAE,MAAM,EAAE;oBACtC,EAAE,QAAQ,EAAE,QAAQ,EAAE,MAAM,EAAE,MAAM,EAAE;iBACvC;aACF,CAAC,CAAC;QACL,CAAC;QAED,OAAO;YACL,OAAO,EAAE,IAAI;YACb,OAAO;YACP,GAAG,EAAE,QAAQ,CAAC,OAAO,CAAC,GAAG,CAAC,WAAW,IAAI,GAAG;YAC5C,MAAM,EAAE,QAAQ,CAAC,MAAM;SACxB,CAAC;IACJ,CAAC;IAAC,OAAO,KAAU,EAAE,CAAC;QACpB,OAAO;YACL,OAAO,EAAE,KAAK;YACd,OAAO,EAAE,EAAE;YACX,GAAG;YACH,KAAK,EAAE,KAAK,CAAC,OAAO;YACpB,MAAM,EAAE,KAAK,CAAC,QAAQ,EAAE,MAAM;SAC/B,CAAC;IACJ,CAAC;AACH,CAAC","names":[],"sources":["/app/tools/webfetch.ts"],"sourcesContent":["/**\n * Fetches content from a specified URL, handles HTTP requests, and extracts text using a readability algorithm.\n */\nimport axios from 'axios';\nimport { convert } from 'html-to-text';\n\nexport interface WebFetchResult {\n  success: boolean;\n  content: string;\n  url: string;\n  error?: string;\n  status?: number;\n}\n\nexport async function webfetch(url: string, format: 'markdown' | 'text' | 'html' = 'markdown'): Promise<WebFetchResult> {\n  try {\n    const response = await axios.get(url, {\n      headers: {\n        'User-Agent': 'Mozilla/5.0 (compatible; OpenCodeResearchBot/1.0; +http://opencode.tools)',\n        'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8',\n        'Accept-Language': 'en-US,en;q=0.5'\n      },\n      timeout: 15000, // 15 seconds timeout\n      validateStatus: (status) => status < 400 // Reject on 4xx/5xx\n    });\n\n    const html = response.data;\n    let content = html;\n\n    if (format === 'markdown' || format === 'text') {\n      content = convert(html, {\n        wordwrap: 130,\n        selectors: [\n          { selector: 'a', options: { ignoreHref: true } },\n          { selector: 'img', format: 'skip' },\n          { selector: 'script', format: 'skip' },\n          { selector: 'style', format: 'skip' },\n          { selector: 'nav', format: 'skip' },\n          { selector: 'footer', format: 'skip' },\n          { selector: 'header', format: 'skip' }\n        ]\n      });\n    }\n\n    return {\n      success: true,\n      content,\n      url: response.request.res.responseUrl || url,\n      status: response.status\n    };\n  } catch (error: any) {\n    return {\n      success: false,\n      content: '',\n      url,\n      error: error.message,\n      status: error.response?.status\n    };\n  }\n}\n"],"version":3}