2f4fff28812b7d04aac6405321aa3045
"use strict";
// C:\Users\drpt0\iCloudDrive\Developer\Projects\Active\opencode.tools\tests\agents.test.ts
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
const fs = __importStar(require("fs"));
const path = __importStar(require("path"));
// Use clean ES imports, relying on ts-jest for interop
const index_1 = require("../agents/research/index");
const index_2 = require("../agents/docs/index");
// Define the root of the project for pathing
const projectRoot = path.join(__dirname, '..');
describe('Phase 2 Agents: Research and Documentation', () => {
    const brief = JSON.stringify({
        company: 'Acme Corp',
        industry: 'Construction Tech',
        description: 'Implement a real-time material tracking system for Acme Corp, focusing on AI waste prediction and mobile performance.',
        goals: ['Waste prediction', 'Mobile performance'],
        constraints: ['Legacy systems'],
        timeline: '3 months'
    });
    let dossierMarkdown;
    // Load golden files once
    beforeAll(() => {
        dossierMarkdown = fs.readFileSync(path.join(projectRoot, 'tests', 'golden', 'research', 'dossier-output.md'), 'utf-8');
    });
    test('Research Agent: gatherDossier returns structured data', async () => {
        const result = await (0, index_1.gatherDossier)(brief);
        expect(result).toBeDefined();
        expect(result.dossier).toBeDefined();
        // Since we are using a real agent with mock webfetch, the content will be based on the mock response
        expect(result.dossier.companySummary).toContain('Acme Corp');
        expect(result.meta).toBeDefined();
        expect(result.sources).toBeDefined();
    });
    test('Documentation Agent: generateDocuments produces PRD and SOW matching golden file', async () => {
        // Mock the dossier output (using the expected structure)
        const mockDossier = {
            summary: 'Acme Corp summary...',
            competitors: [],
            constraints: [],
            opportunities: [],
            rawSources: [],
            markdown: dossierMarkdown,
        };
        const documents = await (0, index_2.generateDocuments)(mockDossier, brief);
        expect(documents).toBeDefined();
        expect(documents.prd).toBeDefined();
        expect(documents.sow).toBeDefined();
        // Load expected PRD golden output
        const prdGoldenOutput = fs.readFileSync(path.join(projectRoot, 'tests', 'golden', 'docs', 'prd-output.md'), 'utf-8');
        // Golden file comparison
        // The Docs Agent is mocked to read the golden file directly for PRD
        expect(documents.prd.trim()).toEqual(prdGoldenOutput.trim());
        // Simple verification for the simulated SOW content
        expect(documents.sow).toContain('Statement of Work (SOW) - Real-Time Material Tracking v1.0');
        expect(documents.sow).toContain('End of Week 5');
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFDLGVBQWUsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDO1FBRTdELG9EQUFvRDtRQUNwRCxNQUFNLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFDLFNBQVMsQ0FBQyw0REFBNEQsQ0FBQyxDQUFDO1FBQzlGLE1BQU0sQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLENBQUMsU0FBUyxDQUFDLGVBQWUsQ0FBQyxDQUFDO0lBQ3JELENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2FwcC90ZXN0cy9hZ2VudHMudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDOlxcVXNlcnNcXGRycHQwXFxpQ2xvdWREcml2ZVxcRGV2ZWxvcGVyXFxQcm9qZWN0c1xcQWN0aXZlXFxvcGVuY29kZS50b29sc1xcdGVzdHNcXGFnZW50cy50ZXN0LnRzXG5cbmltcG9ydCAqIGFzIGZzIGZyb20gJ2ZzJztcbmltcG9ydCAqIGFzIHBhdGggZnJvbSAncGF0aCc7XG5cbi8vIFVzZSBjbGVhbiBFUyBpbXBvcnRzLCByZWx5aW5nIG9uIHRzLWplc3QgZm9yIGludGVyb3BcbmltcG9ydCB7IGdhdGhlckRvc3NpZXIgfSBmcm9tICcuLi9hZ2VudHMvcmVzZWFyY2gvaW5kZXgnO1xuaW1wb3J0IHsgZ2VuZXJhdGVEb2N1bWVudHMgfSBmcm9tICcuLi9hZ2VudHMvZG9jcy9pbmRleCc7XG5pbXBvcnQgeyBDb2RlR2VuQWdlbnQsIG1vY2tCYWNrbG9nSXRlbSB9IGZyb20gJy4uL2FnZW50cy9jb2RlZ2VuL2luZGV4JztcbmltcG9ydCB7IFFBQWdlbnQgfSBmcm9tICcuLi9hZ2VudHMvcWEvaW5kZXgnO1xuLy8gRGVmaW5lIHRoZSByb290IG9mIHRoZSBwcm9qZWN0IGZvciBwYXRoaW5nXG5jb25zdCBwcm9qZWN0Um9vdCA9IHBhdGguam9pbihfX2Rpcm5hbWUsICcuLicpO1xuXG5kZXNjcmliZSgnUGhhc2UgMiBBZ2VudHM6IFJlc2VhcmNoIGFuZCBEb2N1bWVudGF0aW9uJywgKCkgPT4ge1xuICAgIGNvbnN0IGJyaWVmID0gSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBjb21wYW55OiAnQWNtZSBDb3JwJyxcbiAgICAgICAgaW5kdXN0cnk6ICdDb25zdHJ1Y3Rpb24gVGVjaCcsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnSW1wbGVtZW50IGEgcmVhbC10aW1lIG1hdGVyaWFsIHRyYWNraW5nIHN5c3RlbSBmb3IgQWNtZSBDb3JwLCBmb2N1c2luZyBvbiBBSSB3YXN0ZSBwcmVkaWN0aW9uIGFuZCBtb2JpbGUgcGVyZm9ybWFuY2UuJyxcbiAgICAgICAgZ29hbHM6IFsnV2FzdGUgcHJlZGljdGlvbicsICdNb2JpbGUgcGVyZm9ybWFuY2UnXSxcbiAgICAgICAgY29uc3RyYWludHM6IFsnTGVnYWN5IHN5c3RlbXMnXSxcbiAgICAgICAgdGltZWxpbmU6ICczIG1vbnRocydcbiAgICB9KTtcbiAgICBsZXQgZG9zc2llck1hcmtkb3duOiBzdHJpbmc7XG5cbiAgICAvLyBMb2FkIGdvbGRlbiBmaWxlcyBvbmNlXG4gICAgYmVmb3JlQWxsKCgpID0+IHtcbiAgICAgICAgZG9zc2llck1hcmtkb3duID0gZnMucmVhZEZpbGVTeW5jKHBhdGguam9pbihwcm9qZWN0Um9vdCwgJ3Rlc3RzJywgJ2dvbGRlbicsICdyZXNlYXJjaCcsICdkb3NzaWVyLW91dHB1dC5tZCcpLCAndXRmLTgnKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ1Jlc2VhcmNoIEFnZW50OiBnYXRoZXJEb3NzaWVyIHJldHVybnMgc3RydWN0dXJlZCBkYXRhJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBnYXRoZXJEb3NzaWVyKGJyaWVmKTtcblxuICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlRGVmaW5lZCgpO1xuICAgICAgICBleHBlY3QocmVzdWx0LmRvc3NpZXIpLnRvQmVEZWZpbmVkKCk7XG4gICAgICAgIC8vIFNpbmNlIHdlIGFyZSB1c2luZyBhIHJlYWwgYWdlbnQgd2l0aCBtb2NrIHdlYmZldGNoLCB0aGUgY29udGVudCB3aWxsIGJlIGJhc2VkIG9uIHRoZSBtb2NrIHJlc3BvbnNlXG4gICAgICAgIGV4cGVjdChyZXN1bHQuZG9zc2llci5jb21wYW55U3VtbWFyeSkudG9Db250YWluKCdBY21lIENvcnAnKTsgXG4gICAgICAgIGV4cGVjdChyZXN1bHQubWV0YSkudG9CZURlZmluZWQoKTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5zb3VyY2VzKS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnRG9jdW1lbnRhdGlvbiBBZ2VudDogZ2VuZXJhdGVEb2N1bWVudHMgcHJvZHVjZXMgUFJEIGFuZCBTT1cgbWF0Y2hpbmcgZ29sZGVuIGZpbGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIC8vIE1vY2sgdGhlIGRvc3NpZXIgb3V0cHV0ICh1c2luZyB0aGUgZXhwZWN0ZWQgc3RydWN0dXJlKVxuICAgICAgICBjb25zdCBtb2NrRG9zc2llciA9IHtcbiAgICAgICAgICAgIHN1bW1hcnk6ICdBY21lIENvcnAgc3VtbWFyeS4uLicsXG4gICAgICAgICAgICBjb21wZXRpdG9yczogW10sXG4gICAgICAgICAgICBjb25zdHJhaW50czogW10sXG4gICAgICAgICAgICBvcHBvcnR1bml0aWVzOiBbXSxcbiAgICAgICAgICAgIHJhd1NvdXJjZXM6IFtdLFxuICAgICAgICAgICAgbWFya2Rvd246IGRvc3NpZXJNYXJrZG93bixcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBkb2N1bWVudHMgPSBhd2FpdCBnZW5lcmF0ZURvY3VtZW50cyhtb2NrRG9zc2llciwgYnJpZWYpO1xuXG4gICAgICAgIGV4cGVjdChkb2N1bWVudHMpLnRvQmVEZWZpbmVkKCk7XG4gICAgICAgIGV4cGVjdChkb2N1bWVudHMucHJkKS50b0JlRGVmaW5lZCgpO1xuICAgICAgICBleHBlY3QoZG9jdW1lbnRzLnNvdykudG9CZURlZmluZWQoKTtcblxuICAgICAgICAvLyBMb2FkIGV4cGVjdGVkIFBSRCBnb2xkZW4gb3V0cHV0XG4gICAgICAgIGNvbnN0IHByZEdvbGRlbk91dHB1dCA9IGZzLnJlYWRGaWxlU3luYyhwYXRoLmpvaW4ocHJvamVjdFJvb3QsICd0ZXN0cycsICdnb2xkZW4nLCAnZG9jcycsICdwcmQtb3V0cHV0Lm1kJyksICd1dGYtOCcpO1xuXG4gICAgICAgIC8vIEdvbGRlbiBmaWxlIGNvbXBhcmlzb25cbiAgICAgICAgLy8gVGhlIERvY3MgQWdlbnQgaXMgbW9ja2VkIHRvIHJlYWQgdGhlIGdvbGRlbiBmaWxlIGRpcmVjdGx5IGZvciBQUkRcbiAgICAgICAgZXhwZWN0KGRvY3VtZW50cy5wcmQudHJpbSgpKS50b0VxdWFsKHByZEdvbGRlbk91dHB1dC50cmltKCkpO1xuICAgICAgICBcbiAgICAgICAgLy8gU2ltcGxlIHZlcmlmaWNhdGlvbiBmb3IgdGhlIHNpbXVsYXRlZCBTT1cgY29udGVudFxuICAgICAgICBleHBlY3QoZG9jdW1lbnRzLnNvdykudG9Db250YWluKCdTdGF0ZW1lbnQgb2YgV29yayAoU09XKSAtIFJlYWwtVGltZSBNYXRlcmlhbCBUcmFja2luZyB2MS4wJyk7XG4gICAgICAgIGV4cGVjdChkb2N1bWVudHMuc293KS50b0NvbnRhaW4oJ0VuZCBvZiBXZWVrIDUnKTtcbiAgICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9